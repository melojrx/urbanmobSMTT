{% extends 'base.html' %}

{% block conteudo %}

<main class="col-md-12 col-lg-9 col-sm-12 col-xs-12">

  <div class="col-md-9 col-lg-9 container-fluid">

    <div class="container p-0 mb-1 mt-4">
      <h5 class="titulo-filtra-demandas"> <strong> <i class="bi bi-search"></i> Consultas </strong></h5>
      <hr class="mt-1">
    </div>

    <form action="{{url_for('solicitacao.search')}}" method="GET">
      <div class="container main-filtra-eventos">
        <div class="col-3 m-1">
          <label class="form-label m-1"> Protocolo: </label>
          <input type="text" name="numProtocoloSearch" class="form-control form-control-sm m-1"
            placeholder="Número do Protocolo" />
        </div>

        <div class="col-3 m-1">
          <label class="form-label m-1"> Tipo de Solicitação: </label>
          <select class="form-select form-select-sm m-1" aria-label="Selecione o Tipo de Solicitação"
            name="tipoSolicitacaoSearch">
            <option selected value="">- Todos - </option>
            {% for tipoSolicitacao in listTipoSolicitacao %}
            <option value="{{ tipoSolicitacao.id }}">{{ tipoSolicitacao.txtTipoSolicitacao }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="col-3 m-1">
          <label class="form-label m-1"> Status: </label>
          <select class="form-select form-select-sm m-1" aria-label="Selecione o Status" name="statusSearch">
            <option selected value="">- Todos - </option>
            {% for status in listStatus %}
            <option value="{{ status.id }}">{{ status.txtStatus }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="row filtros-button">
          <div class="col-3 m-1">
            <label class="form-label m-1"> Início: </label>
            <input type="date" name="dataInicioSearch" class="form-control form-control-sm m-1"
              placeholder="dd/mm/aa" />
          </div>

          <div class="col-3 m-1">
            <label class="form-label m-1"> Fim: </label>
            <input type="date" name="dataFimSearch" class="form-control form-control-sm m-1" placeholder="dd/mm/aa" />
          </div>

          <div class="col-3 div-button-filtrar-eventos">
            <button type="submit" class="btn btn-outline-success btn-sm m-1">
              <i class="bi bi-filter-circle"></i> Filtrar </button>
            <button type="reset" class="btn btn-outline-danger btn-sm m-1">
              <i class="bi bi-x-circle"></i> Limpar </button>
          </div>
        </div>
      </div>
    </form>
  </div>

  <div class="container p-0 mb-1 mt-4">
    <h5 class="titulo-filtra-demandas"> <strong><i class="bi-list-ul"></i>&nbsp;&nbsp; Lista de Solicitações
      </strong></h5>
    <hr class="mt-1">
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover table-borderless">
      {% if listSolicitacaoHistorico != None %}
      <thead>
        <tr>
          <th scope="col">Solicitação</th>
          <th scope="col">Protocolo</th>
          <th scope="col">Status</th>
          <th scope="col">Data de Início</th>
          <th scope="col">Visualizar</th>
        </tr>
      </thead>
      <tbody>
        {% for solicitacaoHistorico in listSolicitacaoHistorico.items %}
        <tr>
          <td>{{solicitacaoHistorico.solicitacao.tipoSolicitacao.txtTipoSolicitacao}}</td>
          <td>{{solicitacaoHistorico.solicitacao.txtProtocolo}}</td>
          <td>{{solicitacaoHistorico.status.txtStatus}}</td>
          <td>{{solicitacaoHistorico.dataInicio.strftime('%d/%m/%Y %H:%M')}}</td>
          <td class="text-center"><i class="bi bi-binoculars-fill"
              onclick="window.location.href='{{url_for('solicitacao.visualizar', idSolicitacao=solicitacaoHistorico.solicitacao.id)}}';"></i>
          </td>
        </tr>
        {% endfor %}
      </tbody>
      {% else %}
      <tr>
        <td>
          Nenhuma solicitação cadastrada
        </td>
      </tr>
      {% endif %}
    </table>

    {% if listSolicitacaoHistorico != None %}
      <!-- Pagination Links-->
      <div class="container pagination">
        <nav aria-label="Page navigation">
          <ul class="pagination">
            <li> <a
                href="{{ url_for('solicitacao.search', numProtocoloSearch=numProtocoloSearch, statusSearch=statusSearch, dataInicioSearch=dataInicioSearch, dataFimSearch=dataFimSearch, page=listSolicitacaoHistorico.prev_num) }}"
                class="page-link  {% if listSolicitacaoHistorico.page == 1 %}disabled{% endif %}">Anterior</a>
            </li><!-- Loop through the number of pages to display a link for each-->
            {% for page_num in listSolicitacaoHistorico.iter_pages(left_edge=1, right_edge=1, left_current=1,
            right_current=2)
            %}
            {% if page_num %}
            <!-- Check for the active page and set the link to "Active"-->
            {% if listSolicitacaoHistorico.page == page_num %}
            <li class="page-item active"> <a
                href="{{ url_for('solicitacao.search', numProtocoloSearch=numProtocoloSearch, statusSearch=statusSearch, dataInicioSearch=dataInicioSearch, dataFimSearch=dataFimSearch, page=page_num) }}"
                class="page-link">
                {{ page_num }}
              </a></li>
            {% else %}
            <li class="page-item"><a
                href="{{ url_for('solicitacao.search', numProtocoloSearch=numProtocoloSearch, statusSearch=statusSearch, dataInicioSearch=dataInicioSearch, dataFimSearch=dataFimSearch, page=page_num) }}"
                class="page-link">
                {{ page_num }}
              </a></li>
            {% endif %}
            {% else %}
            ...
            {% endif %}
            {% endfor %}
            <li class="page-item"><a
                href="{{ url_for('solicitacao.search', numProtocoloSearch=numProtocoloSearch, statusSearch=statusSearch, dataInicioSearch=dataInicioSearch, dataFimSearch=dataFimSearch, page=listSolicitacaoHistorico.next_num) }}"
                class="page-link 
                    {% if listSolicitacaoHistorico.page == listSolicitacaoHistorico.pages %}disabled{% endif %}">
                Próxima
              </a></li>
          </ul>
        </nav>
      </div>
    {% endif %}
</main>

{% endblock conteudo %}